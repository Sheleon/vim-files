-module(library_process).
-export([ go/1 ]).

go(UserName) ->
    loop([{username, UserName}]).

loop(State) ->
    receive
        {_From, stop, Why} -> % Stop the client 
            io:format("~p~n", [Why]),
            exit(normal);
        {From, } ->
            UserName = proplists:get_value(username, State),
            case proplists:get_value(library_pid) of 
                undefined -> 
                    LibraryPid = proc_lib:spawn(library_process, go, [UserName]),
                    From ! {library_pid, LibraryPid},
                    loop([{username, UserName},{library_pid, LibraryPid}]);
                LibraryPid ->
                    From ! {library_pid, LibraryPid},
                    loop([{username, UserName},{library_pid, LibraryPid}])
            end
    end.
