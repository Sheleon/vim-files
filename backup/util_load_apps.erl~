-module(util_load_apps).
-export([start/0]).
-include_lib("kernel/include/file.hrl").

start() ->
    process_dir("./apps").

process_dir(Path) ->
    {ok, F} = file:list_dir(Path),
    [check_file(Path, Fi) || Fi <- F].

check_file(Path, File) ->
    FileLocation = lists:flatten([Path,"/",File]),
    {ok, Fi} = file:read_file_info(FileLocation),
    case Fi#file_info.type of 
        directory ->
            process_dir(FileLocation);
        regular ->
            check_for_load(File)
    end.

check_for_load(F) ->
    case string:right(F, 4) of
        ".erl" ->
            code:load_file(util_babel:to_atom(string:left(F, string:len(F)-4))),
            lager:info("Loaded: ~s~n", [F]);
        _ ->
            donothing
    end.

tests() ->
    {tests, [
        {what_could_go_wrong, ok}
    ]}.
