-module(external_tests_reference).
-export([tests/0]).

tests() ->
    % HACK: parses python unittest output into Results for the same function; results already 
    % in the parameters...
    TestCmd = io_lib:format("make -B -C \"~s/ole-reference-python/src\" test", [code:priv_dir(external_tests)]),
    lager:debug("Reference Test: ~s~n", [TestCmd]),
    Txt = os:cmd(TestCmd),
    lager:debug("Reference Test OUTPUT: ~s~n", [Txt]),
    Args = external_tests_common:parse_external_unittests(Txt, []),
    % TODO: Leaks atoms, but for Friday it is ok
    Results = [{list_to_atom(Atom), external_tests_common:is_ok(Msg)} || {Atom, Msg} <- lists:reverse(Args)],
    {tests, Results}.
