%% run client unit tests and expose for erlang via tests()
-module(external_tests_protocol).
-export([tests/0]).

%% XXX: This requires magic of the makefile to put the stuff in priv
tests() ->
    TestCmd = io_lib:format( "cd \"~s/ole-reference-protocol\" && ./test.sh", [code:priv_dir(external_tests)]),
    lager:debug("Protocol Test: ~s~n", [TestCmd]),
    Txt = os:cmd(TestCmd),
    lager:debug("Protocol Test OUTPUT: ~s~n", [Txt]),
    Args = external_tests_common:parse_external_unittests(Txt, []),
    Results = [{Name, external_tests_common:is_ok(Res)} || {Name, Res} <- lists:reverse(Args)],
    {tests, Results}.
